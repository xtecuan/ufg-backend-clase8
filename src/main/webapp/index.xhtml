<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="./resources/base-template.xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

    <ui:define name="title">
        Mantenimiento de Personas
    </ui:define>

    <ui:define name="top">
        <p:outputPanel><h1>Mantenimiento de Personas</h1></p:outputPanel>
    </ui:define>

    <ui:define name="content">
        <h:form id="form1">

            <p:messages id="msg"/>

            <p:panelGrid columns="2">
                <p:outputLabel value="Nombres:" for="nombres"/><p:inputText id="nombres" value="#{indexBean.persona.nombres}"/>
                <p:outputLabel value="Apellidos:" for="apellidos"/><p:inputText id="apellidos" value="#{indexBean.persona.apellidos}"/>
                <p:outputLabel value="Email:" for="email" /><p:inputText id="email" value="#{indexBean.persona.email}"/>
                <p:outputLabel value="sexo:" for="sexo" />

                <p:selectOneMenu id="sexo" value="#{indexBean.persona.sexo}" >
                    <f:selectItems value="#{indexBean.sexoOptions}"/>
                </p:selectOneMenu>

                <p:outputLabel for="fechaNacimiento" value="Fecha Nacimiento:"/>
                <p:datePicker id="fechaNacimiento" value="#{indexBean.persona.fechaNacimiento}"  monthNavigator="true" yearNavigator="true"
                              pattern="yyyy-MM-dd" yearRange="1920:2022"/>            

            </p:panelGrid>

            <p:commandButton rendered="#{empty indexBean.persona.idPersona}" value="Guardar" actionListener="#{indexBean.guardarPersona}" update="form1,formData"/>
            <p:commandButton rendered="#{not empty indexBean.persona.idPersona}" value="Actualizar" actionListener="#{indexBean.actualizarPersona}" update="form1,formData"/>
            <p:commandButton  value="Cancelar" actionListener="#{indexBean.cancelar}" update="form1,formData"/>
        </h:form>
        <h:form id="formData">

            <p:panel>
                <p:dataTable id="personas" var="persona" value="#{indexBean.personas}" rowKey="#{persona.idPersona}"
                             selection="#{indexBean.selectedPersona}" selectionMode="single" rows="5" paginator="true" paginatorPosition="both"
                             paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                             currentPageReportTemplate="{startRecord}-{endRecord} of {totalRecords} records"
                             rowsPerPageTemplate="5,10,{ShowAll|'All'}">
                    <f:facet name="header">
                        Seleccionar una persona para editar o borrar (Click derecho)
                    </f:facet>

                    <p:column headerText="IdPersona">
                        <h:outputText value="#{persona.idPersona}" />
                    </p:column>
                    <p:column headerText="Nombres">
                        <h:outputText value="#{persona.nombres}" />
                    </p:column>
                    <p:column headerText="Apellidos">
                        <h:outputText value="#{persona.apellidos}" />
                    </p:column>
                    <p:column headerText="Email">
                        <h:outputText value="#{persona.email}" />
                    </p:column>
                    <p:column headerText="Fecha Nacimiento:">
                        <h:outputText value="#{persona.fechaNacimiento}" converter="#{dateConverter}">
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Sexo">                       
                        <h:outputText value="#{persona.sexo eq 'M' ? 'Hombre' : 'Mujer'}" />
                    </p:column>
                </p:dataTable>

                <p:contextMenu for="personas">
                    <p:menuitem value="Borrar" update="formData,form1" icon="pi pi-times"
                                action="#{indexBean.deletePersona}"/>
                    <p:menuitem value="Actualizar" update="form1" icon="pi pi-times"
                                action="#{indexBean.prepareEdit}"/>
                </p:contextMenu>
            </p:panel>


        </h:form>
    </ui:define>

</ui:composition>
